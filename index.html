<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <title>Amputee Generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <body>
    <h1 id="amputee"><noscript>This page needs JavaScript.</noscript></h1>
    <p>Support for fingers and toes coming soon!</p>
    <button id="refresh">Refresh</button>
  </body>
  <script>
    (function global() {
      function choice(items) {
        return items[Math.floor(Math.random() * items.length)];
      }
      function weightedChoice(itemDict) {
        var sum = 0;
        var position = Math.random();
        for (var item in itemDict) {
          sum += itemDict[item];
          if (position <= sum) {
            return item;
          }
        }
      }
      function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }
      function adverbify(verb) {
        var adverb = choice([null, 'deliberately', 'intentionally', 'voluntarily']);
        if (adverb) {
          return adverb + ' ' + verb;
        } else {
          return verb;
        }
      }
      function shuffle(array) {
        for (var i = array.length - 1; i > 0; i--) {
          var j = Math.floor(Math.random() * (i + 1));
          var temp = array[i];
          array[i] = array[j];
          array[j] = temp;
        }
        return array;
      }
      function pluralize(word) {
        switch (word) {
          case 'foot':
            return 'feet';
          default:
            return word + 's';
        }
      }
      function aggregate(list) {
        switch (list.length) {
          case 1:
            return list[0];
            break;
          case 2:
            return list[0] + ' and ' + list[1];
          default:
            return list.slice(0, list.length - 1).join(', ') + ', and ' + list[list.length - 1];
        }
      }
      function refresh() {
        var gender = choice([{subj: 'he', obj: 'him', poss: 'his'}, {subj: 'she', obj: 'her', poss: 'her'}]);
        var method = choice([
            'lost', 'is missing', 'no longer has', adverbify('cut off'), adverbify('chopped off'), adverbify('sliced off'),
            adverbify('lopped off'), adverbify('severed'), adverbify('amputated'), adverbify('removed')]);
        var numberOfLimbs = Number(weightedChoice({1: 0.4, 2: 0.3, 3: 0.2, 4: 0.1}));
        var limbs = [];        
        var limbOptions = [
            {side: 'left', part: choice(['hand', 'arm'])},
            {side: 'right', part: choice(['hand', 'arm'])},
            {side: 'left', part: choice(['foot', 'leg'])},
            {side: 'right', part: choice(['foot', 'leg'])}];
        var limbIndexOptions = [0, 1, 2, 3];
        shuffle(limbIndexOptions);
        var limbIndices = limbIndexOptions.slice(0, numberOfLimbs);
        limbIndices.sort();
        for (var i = 0; i < numberOfLimbs; i++) {
          limbs.push(limbOptions[limbIndices[i]]);
        }
        var limbPhrases = [];
        if (numberOfLimbs === 4 && limbs[0].part === 'arm' && limbs[1].part === 'arm' && limbs[2].part === 'leg' &&
            limbs[3].part === 'leg') {
          limbPhrases.push('all four of ' + gender.poss + ' limbs');
        } else {
          for (var i = 0; i < limbs.length - 1; i++) {
            if (limbs[i].part === limbs[i + 1].part) {
              limbPhrases.push('both of ' + gender.poss + ' ' + pluralize(limbs[i].part));
              i++;
            } else {
              limbPhrases.push(limbs[i].side + ' ' + limbs[i].part);
            }
          }
          if (i === limbs.length - 1) {
            limbPhrases.push(limbs[i].side + ' ' + limbs[i].part);
          }
        }
        document.getElementById('amputee').innerText =
            capitalize(gender.subj) + ' ' + method + ' ' + gender.poss + ' ' + aggregate(limbPhrases) + '.';
      }
      document.getElementById('refresh').onclick = refresh;
      refresh();
    })();
  </script>
</html>
